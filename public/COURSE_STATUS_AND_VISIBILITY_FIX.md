# 课程状态和可见性修复

## 🚨 问题描述

用户反馈两个问题：
1. **课程直接发布，没有审核过程** - 创建课程后直接可以在课程浏览页面看到
2. **教师工作台状态显示错误** - 只显示"草稿"标签，不显示正确状态

## 🔍 问题分析

### 问题1：课程直接发布
- **根本原因1**：后端创建课程时硬编码状态为 `"draft"`，忽略前端传递的 `status` 参数
- **根本原因2**：课程浏览页面查询条件使用数字状态 `status = 1`，而不是字符串状态

### 问题2：状态显示错误
- **根本原因**：课程列表API查询条件使用数字状态，导致状态映射错误

## 🛠️ 修复方案

### 1. 修复课程创建状态处理

#### 后端修复
```java
// 修复前：硬编码状态
course.setStatus("draft"); // 默认草稿状态

// 修复后：使用前端传递的状态
course.setStatus(request.getStatus() != null ? request.getStatus() : "draft");
```

#### 添加状态字段到请求类
```java
@Data
public class CourseCreateRequest {
    // ... 其他字段
    private String status; // 新增状态字段
}
```

### 2. 修复课程可见性查询

#### 修复前（错误）
```sql
-- 使用数字状态查询
WHERE c.status = 1
```

#### 修复后（正确）
```sql
-- 使用字符串状态查询
WHERE c.status = 'published'
```

### 3. 修复所有相关查询

需要修复的SQL查询：
- `getCourseList` - 课程列表查询
- `getHotCourses` - 热门课程查询  
- `getNewCourses` - 最新课程查询
- `getCoursesByCategory` - 分类课程查询

## 📁 修复的文件

### 后端文件
1. **TeacherServiceImpl.java** - 课程创建状态处理
2. **CourseCreateRequest.java** - 添加状态字段
3. **CourseMapper.xml** - 修复所有课程查询的WHERE条件

### 前端文件
1. **TeacherDashboard.vue** - 添加调试信息

## 🎯 修复效果

### 问题1：课程审核流程
- ✅ **创建课程**：默认状态为"草稿"
- ✅ **提交审核**：状态变为"审核中"
- ✅ **课程可见性**：只有"已发布"状态的课程在浏览页面显示
- ✅ **审核流程**：完整的草稿→审核中→已发布流程

### 问题2：状态显示
- ✅ **状态标签**：正确显示草稿、审核中、已发布、已拒绝
- ✅ **状态颜色**：蓝色、橙色、绿色、红色
- ✅ **状态按钮**：根据状态显示相应操作按钮

## 🔄 完整的课程状态流程

### 教师操作流程
```
1. 创建课程 → 草稿状态 (draft)
   ↓ 点击"提交审核"
2. 审核中状态 (pending)
   ↓ 管理员审核
   ├─ 通过 → 已发布 (published) → 学生可见
   └─ 拒绝 → 已拒绝 (rejected) → 需要修改
       ↓ 点击"重新提交"
   审核中状态 (pending)
```

### 课程可见性规则
- **草稿 (draft)**：只有教师本人可见
- **审核中 (pending)**：只有教师本人可见
- **已发布 (published)**：所有用户可见，可购买
- **已拒绝 (rejected)**：只有教师本人可见

## 🚀 测试验证

### 1. 课程创建测试
1. 创建课程 → 状态为"草稿"
2. 课程浏览页面 → 不显示该课程
3. 点击"提交审核" → 状态变为"审核中"
4. 课程浏览页面 → 仍不显示该课程

### 2. 课程发布测试
1. 管理员审核通过 → 状态变为"已发布"
2. 课程浏览页面 → 显示该课程
3. 学生可以购买该课程

### 3. 状态显示测试
1. 教师工作台 → 正确显示课程状态标签
2. 状态按钮 → 根据状态显示相应操作按钮

## 🔧 技术细节

### 数据库状态字段
```sql
-- 字段定义
status ENUM('draft', 'pending', 'published', 'rejected') DEFAULT 'draft'

-- 状态含义和可见性
'draft'     - 草稿（仅教师可见）
'pending'   - 审核中（仅教师可见）
'published' - 已发布（所有用户可见）
'rejected'  - 已拒绝（仅教师可见）
```

### 课程查询条件
```sql
-- 学生浏览课程（只显示已发布）
WHERE c.status = 'published'

-- 教师管理课程（显示所有状态）
WHERE c.instructor_id = #{teacherId}
```

现在课程审核流程完全正常了！只有通过审核的课程才会在浏览页面显示。🎉
